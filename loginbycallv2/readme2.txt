Подробнее про хуки смотрите https://developer.wordpress.org/plugins/hooks/

loginbycall.php


    loginbycall_auth_signon
Это основной хук входа, который выполняется при авторизации пользователя (authenticate).
В нём проверяется, что:
1) пользователь найден по логину или email в базе;
2) пользователь не ввел пароль;
3) у пользователя есть доступ к однофакторной авторизации LoginByCall;
4) опция входа через LoginByCall у пользователя включена.
В этом случае сохраняется флаг безпарольного входа в сессию ID этого пользователя.
Если телефон заполнен, то идет редирект на форму ввода пин-кода (последние 4 цифры входящего номера).
Если проверка неудачная, то переход на следущий хук loginbycall_check_password

    loginbycall_check_password
хук wp check_password(проверка пароля)
В начале идет проверка:
Пользователь отказался от регистрации и у пользователя не включен флаг активного плагина, тогда идет обычный логин.
Затем идет проверка:
Если у юзера выставлена однофакторная авторизация и пароль верен и есть доступ к однофакторной то логин
Следом идет проверка, есть ли доступ к однофакторной или (двухфакторной и правильный пароль).
Если проверка прошла то проверяем, заполнен у юзера телефон
Если заполнен, то прыгаем на форму с пином, иначе на форму передложения ввода телефона

    loginbycall_phone_check
хук registration_errors для вывода ошибки о пустом телефоне при обязательном заполнении или занятом

    loginbycall_registration_save
Сохранение регистрационных даных юзера, а так же выставление wp_schedule_single_event при заполненом телефоне на сутки.
Если юзер не зайдет в течении этого времени то его акк удалиться.
Если юзер выбрал однофакторную, то его кинет на форму с вводом пина, иначе стандартный wp

    loginbycall_delete_users_daily
Удаление не активных юзеров из loginbycall_registration_save

    loginbycall_get_balance
Получение баланса для аякс

    verify_logincall_pin
Проверка пина через аякс изпользуеться как при логине, так и смене тела в профиле
Каждый раз записывается количество попыток входа, если набирается больше 3х то маска ввода очищается и выводится ошибака.
Если введеный пин совпадает с маской:
    Если юзер не залогинет, то юзер авторизуется,
    Иначе если у него указан новый телефон, то он заполняется.

    call_status_ajax
Функция для проверки статуса звонка

    verify_logincall
Функция для проверки апи ключа сервисом

    loginbycall_uninstall_hook
Хук удаления

    loginbycall_form_panel
Функция для вывода данных при  регистрации

    loginbycall_login_panel_step2
Функция для отображения формы пина

    render_pin_form
Функция для вывода самой формы с пином, так же в ней происходит звонок если хватает прав.
При неудачном звонке ошибка заносится в сессеию и выводится ошибка
При удачном звонке запносится айди звонка, и маска

    loginbycall_login_panel_step1
Форма для показа уже зарегистрированым юзерам но еще не видевшие плагин. Показывается после обычного логина

    loginbycall_is_unique_phone
Проверка на уникальность телефона в бд

    loginbycall_save_extra_profile_fields
Сохранение пользовательской инф при редактировании профайла

    loginbycall_show_extra_profile_fields
Отображение полей плагина в профиле пользователя

    loginbycall_render_login_types
Вывод radio кнопок для отображения выбора способа входа с учетом правил в настройках.

    render_settings_loginbycall
Вывод формы настроек плагина

    loginbycall_change_options
Функция для изменения настроек плагина, прямая ссылка на меню в админке

function.php

    service_loginbycall
Вызов апи сервиса с передачей данных к нему

    call_loginbycall
Вызов звонка

    pay_loginbycall
Вызов форма оплаты

    lbc_get_safe
Безопасное получение свойства объекта, при неудаче получаем пустую строку

    call_hangup
Положить трубу вызова

    register_loginbycall
Регистрация на сервисе

    status_loginbycall
Проверка статуса аккаунта

    server_status
Проверка статуса работы сервиса

    call_status
Выяснение статуса звонка

    change_credential
Изменение почты уведомлений со сменой апи клича

    credential_confirm
Подверждение после изменения ключа, при котором аккаунт получает возможность работы по новому ключу

    options_loginbycall
Изменение лимита уведомлений

    balance_loginbycall
Получение баланса

    get_one_field
Функция получения значения единственного поля

    loginbycall_generator
Генератор nonce для выхова апи

    loginbycall_check_allowed_role
Проверка доступа к однофакторной или двухфакторной авторизации

    loginbycall_update_roles
Функция для обновления ролей
возвращаем true если телефон обязательный и хотябы одного способо нет в одной роле. Используется в настройках плагина

    getFlashError
Функция для отображения ошибки из сессии с последующей удалением ее из сессии

    getNotificationEmail
Получение емейла для уведомлений

    setNotificationEmail
Выставление емейла для уведомлений



